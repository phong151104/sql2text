catalog: lakehouse
schema: lh_vnfilm_v2
table_name: bank
domain: vnfilm_ticketing

table_type: dim
business_name: "Bảng thông tin ngân hàng (bank)"
grain: "1 dòng = 1 ngân hàng / đối tác thanh toán"

description: >
  Bảng dimension lưu thông tin ngân hàng: mã hiển thị, tên đa ngôn ngữ,
  mã gateway/OTT/promotion, cấu hình hỗ trợ SMS/OTT/email/pilot, cùng trạng thái.
  Thường được join với các bảng fact giao dịch/đơn hàng qua bank_id.

tags:
  - dimension_table
  - bank
  - payment
  - partner

primary_key:
  - id

foreign_keys: []

time_columns:
  - created_date
  - modified_date

recommended_filters:
  - "status để lọc bank đang hoạt động"
  - "code, gateway_bank_code, promotion_bank_code khi phân tích theo kênh ngân hàng"
  - "created_date, modified_date cho phân tích lịch sử cấu hình bank"

concepts:
  - name: bank
    synonyms: ["ngân hàng", "bank", "thẻ", "issuer"]

  - name: gateway
    synonyms: ["gateway", "gateway_bank", "cổng ngân hàng"]

  - name: ott
    synonyms: ["OTT", "ott_support", "thông báo OTT"]

  - name: sms
    synonyms: ["SMS", "tin nhắn", "sms_support"]

  - name: email
    synonyms: ["email", "thư điện tử", "email_support"]

  - name: promotion
    synonyms: ["khuyến mại", "khuyến mãi", "promotion", "mã giảm giá"]

columns:
  id:
    data_type: bigint
    business_name: "ID ngân hàng"
    description: "Định danh duy nhất cho mỗi ngân hàng/partner thanh toán."
    semantics: [id, primary, bank]
    pii: false

  code:
    data_type: varchar
    business_name: "Mã ngân hàng"
    description: "Mã code dùng nội bộ/hiển thị để nhận diện ngân hàng."
    semantics: [code, bank]

  name_vi:
    data_type: varchar
    business_name: "Tên ngân hàng (Tiếng Việt)"
    description: "Tên hiển thị của ngân hàng bằng tiếng Việt."
    semantics: [name, bank, vi]

  name_en:
    data_type: varchar
    business_name: "Tên ngân hàng (Tiếng Anh)"
    description: "Tên hiển thị của ngân hàng bằng tiếng Anh."
    semantics: [name, bank, en]

  gateway_bank_code:
    data_type: varchar
    description: "Mã ngân hàng tại phía gateway (cổng thanh toán)."
    semantics: [code, bank, gateway]

  ott_bank_code:
    data_type: varchar
    description: "Mã ngân hàng dùng cho kênh OTT (nếu khác với code/gateway)."
    semantics: [code, bank, ott]

  promotion_bank_code:
    data_type: varchar
    description: "Mã ngân hàng dùng trong hệ thống khuyến mại/promotion."
    semantics: [code, bank, promotion]

  ott_support:
    data_type: varchar
    description: "Cấu hình/cờ cho biết ngân hàng có hỗ trợ OTT notification hay không."
    semantics: [flag, ott, support]

  sms_support:
    data_type: varchar
    description: "Cấu hình/cờ cho biết ngân hàng có hỗ trợ SMS hay không."
    semantics: [flag, sms, support]

  promotion_support:
    data_type: varchar
    description: "Cấu hình/cờ cho biết ngân hàng có tham gia chương trình khuyến mại hay không."
    semantics: [flag, promotion, support]

  status:
    data_type: varchar
    description: "Trạng thái hoạt động của ngân hàng (ACTIVE/INACTIVE/...)."
    semantics: [status, bank_status]

  created_date:
    data_type: timestamp(6)
    description: "Thời điểm tạo bản ghi ngân hàng."
    semantics: [date, created_time]

  created_by:
    data_type: varchar
    description: "User/service tạo bản ghi ngân hàng."
    semantics: [user_identity, creator, raw]
    pii: true
    sensitive: true

  modified_date:
    data_type: timestamp(6)
    description: "Thời điểm cập nhật bản ghi ngân hàng gần nhất."
    semantics: [date, modified_time]

  modified_by:
    data_type: varchar
    description: "User/service cập nhật bản ghi ngân hàng."
    semantics: [user_identity, modifier, raw]
    pii: true
    sensitive: true

  service_code:
    data_type: varchar
    description: "Mã service/hệ thống tích hợp với ngân hàng (nếu có)."
    semantics: [code, service]

  provider_code:
    data_type: varchar
    description: "Mã provider/đối tác trung gian (nếu ngân hàng đi qua provider)."
    semantics: [code, provider]

  ott_pilot_support:
    data_type: varchar
    description: "Cờ/cấu hình ngân hàng tham gia pilot OTT."
    semantics: [flag, ott, pilot]

  sms_pilot_support:
    data_type: varchar
    description: "Cờ/cấu hình ngân hàng tham gia pilot SMS."
    semantics: [flag, sms, pilot]

  promotion_pilot_support:
    data_type: varchar
    description: "Cờ/cấu hình ngân hàng tham gia pilot các chương trình promotion."
    semantics: [flag, promotion, pilot]

  channel_ids:
    data_type: varchar
    description: "Danh sách channel id/kenh cấu hình cho ngân hàng (dạng text/list)."
    semantics: [channel, config]

  email_pilot_support:
    data_type: varchar
    description: "Cờ/cấu hình ngân hàng tham gia pilot kênh email."
    semantics: [flag, email, pilot]

  email_pilot_support_hash:
    data_type: varchar
    description: "Giá trị hash phục vụ xử lý nội bộ liên quan email pilot (nếu có)."
    semantics: [hash, email, pilot]
    pii: false
    sensitive: true

  email_support:
    data_type: varchar
    description: "Cờ/cấu hình ngân hàng có hỗ trợ email hay không."
    semantics: [flag, email, support]

  email_support_hash:
    data_type: varchar
    description: "Giá trị hash phục vụ xử lý nội bộ liên quan email support."
    semantics: [hash, email, support]
    pii: false
    sensitive: true

  logo:
    data_type: varchar
    description: "Đường dẫn/logo ngân hàng (URL hoặc path)."
    semantics: [logo, media]

  live_activity_support:
    data_type: varchar
    description: "Cấu hình ngân hàng có hỗ trợ live activity/real-time feature hay không."
    semantics: [flag, live_activity, support]

guardrails:
  sql:
    read_only: true
    require_limit: true
    default_limit: 200
    forbid_select_star: true
    preferred_time_filter: "created_date"
    allowed_time_columns:
      - created_date
      - modified_date
    forbidden_columns:
      - created_by
      - modified_by

sample_questions:
  - "Danh sách các ngân hàng đang active và có tham gia promotion?"
  - "Ngân hàng nào đang hỗ trợ OTT, SMS và email cùng lúc?"
  - "Số lượng ngân hàng theo từng provider_code là bao nhiêu?"
  - "Những ngân hàng nào đang được cấu hình pilot cho OTT hoặc SMS?"

sample_queries:
  - description: "Danh sách ngân hàng đang active và có hỗ trợ promotion"
    sql: |
      SELECT
        id,
        code,
        name_vi,
        promotion_support,
        status
      FROM lakehouse.lh_vnfilm_v2.bank
      WHERE status = 'ACTIVE'
        AND promotion_support = 'Y';

  - description: "Ngân hàng hỗ trợ đủ 3 kênh OTT, SMS, email"
    sql: |
      SELECT
        id,
        code,
        name_vi,
        ott_support,
        sms_support,
        email_support
      FROM lakehouse.lh_vnfilm_v2.bank
      WHERE ott_support = 'Y'
        AND sms_support = 'Y'
        AND email_support = 'Y';

  - description: "Số lượng ngân hàng theo provider_code"
    sql: |
      SELECT
        provider_code,
        COUNT(*) AS bank_count
      FROM lakehouse.lh_vnfilm_v2.bank
      GROUP BY provider_code
      ORDER BY bank_count DESC;
